// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// -----------------------------------------------------------
// 1. ìœ ì € ë° ì¸ì¦ (User & Auth)
// -----------------------------------------------------------

// íšŒì› ìœ í˜• ì •ì˜
enum UserRole {
  BUYER  // êµ¬ë§¤ì
  SELLER // íŒë§¤ì
}

model User {
  id              Int       @id @default(autoincrement())
  email           String    @unique 
  password        String    
  name            String    @unique
  type            UserRole  @default(BUYER) 
  image           String?    
  refreshToken    String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // ê´€ê³„ ì„¤ì •
  store           Store?    // íŒë§¤ì: 1ëª…ì˜ íŒë§¤ìëŠ” 0 ë˜ëŠ” 1ê°œì˜ ìŠ¤í† ì–´ë¥¼ ê°€ì§‘ë‹ˆë‹¤.
  inquiries       Inquiry[] // ë¬¸ì˜
  reviews         Review[]  // ë¦¬ë·°
  cartItems       CartItem[] // ì¥ë°”êµ¬ë‹ˆ í•­ëª©
  orders          Order[]   // ì£¼ë¬¸/êµ¬ë§¤
  userPoints      UserPoint? // í¬ì¸íŠ¸ ë° ë“±ê¸‰ ì •ë³´
  favoriteStores  FavoriteStore[] // ê´€ì‹¬ ìŠ¤í† ì–´
}

// -----------------------------------------------------------
// 2. ìŠ¤í† ì–´ ë° ìƒí’ˆ (Store & Product)
// -----------------------------------------------------------

model Store {
  id             Int       @id @default(autoincrement())
  sellerId       Int       @unique // íŒë§¤ì ID (1:1 ê´€ê³„)
  name           String
  address        String
  phoneNumber    String
  storeImageUrl  String?
  description    String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // ê´€ê³„ ì„¤ì •
  seller         User      @relation(fields: [sellerId], references: [id])
  products       Product[] // ìƒí’ˆ
  favorites      FavoriteStore[] // ì´ ìŠ¤í† ì–´ë¥¼ ê´€ì‹¬ ìŠ¤í† ì–´ë¡œ ë“±ë¡í•œ ì‚¬ìš©ì ëª©ë¡
}

// ìƒí’ˆ ì¹´í…Œê³ ë¦¬ ì •ì˜
enum ProductCategory {
  TOP
  BOTTOM
  OUTER
  DRESS
  SKIRT
  SHOES
  ACC
  ETC // ê¸°íƒ€
}

model Product {
  id             Int               @id @default(autoincrement())
  storeId        Int
  name           String
  mainImageUrl   String
  price          Int               // íŒë§¤ê°€
  category       ProductCategory
  detailInfo     String
  totalSales     Int               @default(0) // íŒë§¤ëŸ‰ (ì¶”ì²œ ìƒí’ˆ ë° ì •ë ¬ ê¸°ì¤€)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt

  // í• ì¸ ê´€ë ¨ í•„ë“œ (ì„ íƒ ì‚¬í•­)
  discountPrice  Int?              // í• ì¸ê°€
  discountStart  DateTime?         // í• ì¸ ì‹œì‘ì¼
  discountEnd    DateTime?         // í• ì¸ ì¢…ë£Œì¼

  // ê´€ê³„ ì„¤ì •
  store          Store             @relation(fields: [storeId], references: [id])
  stocks         ProductStock[]    // ì‚¬ì´ì¦ˆë³„ ì¬ê³ 
  inquiries      Inquiry[]         // ë¬¸ì˜
  reviews        Review[]          // ë¦¬ë·°
  cartItems      CartItem[]        // ì¥ë°”êµ¬ë‹ˆ í•­ëª©
  orderItems     OrderItem[]       // ì£¼ë¬¸ëœ ìƒí’ˆ í•­ëª©
}

model ProductStock {
  id        Int     @id @default(autoincrement())
  productId Int
  size      String  // ì˜ˆ: S, M, L, 260 ë“±
  quantity  Int     @default(0)

  @@unique([productId, size]) // ìƒí’ˆë³„ ì‚¬ì´ì¦ˆëŠ” ìœ ì¼í•´ì•¼ í•¨

  // ê´€ê³„ ì„¤ì •
  product   Product @relation(fields: [productId], references: [id])
}

// -----------------------------------------------------------
// 3. ì¥ë°”êµ¬ë‹ˆ ë° êµ¬ë§¤ (Cart & Purchase)
// -----------------------------------------------------------

model CartItem {
  id        Int      @id @default(autoincrement())
  userId    Int
  productId Int
  quantity  Int
  size      String   // ì„ íƒëœ ì‚¬ì´ì¦ˆ
  createdAt DateTime @default(now())

  @@unique([userId, productId, size]) // ì‚¬ìš©ì, ìƒí’ˆ, ì‚¬ì´ì¦ˆ ì¡°í•©ì€ ìœ ì¼í•´ì•¼ í•¨

  // ê´€ê³„ ì„¤ì •
  user      User     @relation(fields: [userId], references: [id])
  product   Product  @relation(fields: [productId], references: [id])
}

// ì£¼ë¬¸ ìƒíƒœ ì •ì˜
enum OrderStatus {
  PENDING    // ê²°ì œ ëŒ€ê¸°
  PAID       // ê²°ì œ ì™„ë£Œ
  SHIPPED    // ë°°ì†¡ ì¤‘
  DELIVERED  // ë°°ì†¡ ì™„ë£Œ
  CANCELED   // ì·¨ì†Œ
}

model Order {
  id                 Int         @id @default(autoincrement())
  userId             Int
  orderNumber        String      @unique
  totalAmount        Int         // ì´ ê²°ì œ ê¸ˆì•¡
  usedPoints         Int         @default(0) // ì‚¬ìš©ëœ í¬ì¸íŠ¸
  status             OrderStatus @default(PAID)
  recipientName      String
  recipientPhone     String
  deliveryAddress    String
  paymentDate        DateTime?   // ê²°ì œ ì™„ë£Œ ì‹œì 
  createdAt          DateTime    @default(now())

  // ê´€ê³„ ì„¤ì •
  user               User        @relation(fields: [userId], references: [id])
  orderItems         OrderItem[] // ì£¼ë¬¸ëœ ìƒí’ˆ í•­ëª© ëª©ë¡
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  orderId   Int
  productId Int
  quantity  Int
  price     Int     // ì£¼ë¬¸ ë‹¹ì‹œ ìƒí’ˆ ê°€ê²© (í• ì¸ ì ìš© ê°€ê²©)
  size      String  // ì£¼ë¬¸ëœ ì‚¬ì´ì¦ˆ

  // ê´€ê³„ ì„¤ì •
  order     Order   @relation(fields: [orderId], references: [id])
  product   Product @relation(fields: [productId], references: [id])
  review    Review? // ì´ ì£¼ë¬¸ í•­ëª©ì— ëŒ€í•´ ì‘ì„±ëœ ë¦¬ë·° (1:1 ë˜ëŠ” 1:0)
}

// -----------------------------------------------------------
// 4. ë¬¸ì˜ ë° ë¦¬ë·° (Inquiry & Review)
// -----------------------------------------------------------

model Inquiry {
  id        Int      @id @default(autoincrement())
  userId    Int
  productId Int
  title     String
  content   String
  isSecret  Boolean  @default(false) // ë¹„ë°€ê¸€ ì—¬ë¶€
  hasAnswer Boolean  @default(false) // ë‹µë³€ ìƒíƒœ
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ê´€ê³„ ì„¤ì •
  user      User     @relation(fields: [userId], references: [id])
  product   Product  @relation(fields: [productId], references: [id])
  answer    InquiryAnswer? // ë‹µë³€ (1:1 ê´€ê³„)
}

model InquiryAnswer {
  id          Int      @id @default(autoincrement())
  inquiryId   Int      @unique
  sellerId    Int      // ë‹µë³€í•œ íŒë§¤ì ID (í•„ìš”ì‹œ)
  content     String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // ê´€ê³„ ì„¤ì •
  inquiry     Inquiry  @relation(fields: [inquiryId], references: [id])
}

model Review {
  id          Int      @id @default(autoincrement())
  userId      Int
  productId   Int
  orderItemId Int      @unique // êµ¬ë§¤í•œ ìƒí’ˆì— ëŒ€í•´ì„œë§Œ ì‘ì„± ê°€ëŠ¥í•˜ë„ë¡ OrderItemê³¼ 1:1 ì—°ê²°
  rating      Int      // ë³„ì  (1~5)
  content     String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // ê´€ê³„ ì„¤ì •
  user        User     @relation(fields: [userId], references: [id])
  product     Product  @relation(fields: [productId], references: [id])
  orderItem   OrderItem @relation(fields: [orderItemId], references: [id])
}

// -----------------------------------------------------------
// 5. í¬ì¸íŠ¸ ë° ë“±ê¸‰ (Points & Grade)
// -----------------------------------------------------------

// ì‚¬ìš©ì ë“±ê¸‰ ì •ì˜
enum UserGrade {
  BRONZE
  SILVER
  GOLD
  PLATINUM
}

model UserPoint {
  id              Int       @id @default(autoincrement())
  userId          Int       @unique
  points          Int       @default(0) // ğŸ’¡ í•„ë“œ ì´ë¦„ì„ 'points'ë¡œ í†µì¼í–ˆìŠµë‹ˆë‹¤. 
  accumulatedAmount Int     @default(0) 
  grade           UserGrade @default(BRONZE) 
  pointRate       Float     @default(0.01) 

  // ê´€ê³„ ì„¤ì •
  user            User      @relation(fields: [userId], references: [id])
}

// -----------------------------------------------------------
// 6. ê´€ì‹¬ ìŠ¤í† ì–´ (Favorite Store)
// -----------------------------------------------------------

model FavoriteStore {
  id        Int      @id @default(autoincrement())
  userId    Int
  storeId   Int
  createdAt DateTime @default(now())

  @@unique([userId, storeId]) // ì‚¬ìš©ìë³„ ìŠ¤í† ì–´ëŠ” í•œ ë²ˆë§Œ ë“±ë¡ ê°€ëŠ¥

  // ê´€ê³„ ì„¤ì •
  user      User     @relation(fields: [userId], references: [id])
  store     Store    @relation(fields: [storeId], references: [id])
}